# How to use this script
## 1. Download or Clone this project.

## 2. Ensure Defects4j 2.0 has installed in your machine.
Install Defects4j 2.0 and configure the environment path. Ensure all defects4j command is available.
## 3. Download dependences.
run `pip install javalang` and `pip install openai`.(To ensure the openai api is workable,a python version 3.10 is needed.)
## 4. Set your openapi key and base url.
Modify the openai api key and base url in constant.py.
## 5. Run the script with arguments.
run the script by command `python main.py` with 2 arguments, the first argument is your instruction, the second is the project.

instruction:
- `initial-save` save the initial prompt of all bugs of your project.
- `initial-chat` chat with chatgpt only using the initial prompt and just one shot.
- `chatrepair` run the method chatrepair.

project:
- Lang
- Chart
- Closure
- Mockito
- Math
- Time

eg:
run this command:
`python main.py initial-save Lang`
will save initial prompt of all bugs of the project Lang.

**Note that a valid openai apikey and secret is necessary!**

# Differences between Original ChatRepair
1. The form of "Few Shot Example" was not given in the paper. 
2. When validate the patch generated by Chatgpt, if original failure test still failed, the paper use prompt "The fixed version is still not correct. It still does not fix the original test failure". This approach is a bit difficult to implement in code. This implementation just repeat the TestName+ErrMsg+FailLine, although this is redundant.
3. I'm not sure what kind of patch belongs to the single function type.In this implementation, I only use single function type prompt for "delete" type patch because "delete" type patch can't provide an original buggy hunk.
4. The maximum number of repair attempts allowed (including both initial repair and plausible patch generation steps) is 200 for single-line and single-hunk APR, and 100 for the single-function scenario of the experiment setting of the paper. This is too many for our study purpose. In order to minimize time and financial costs while obtaining results quickly, our experiments set the maximum number of attempts for each bug to be 3.
5. In order for ChatGPT to analyze the question when answering and surround the code in Markdown format, we have slightly modified the last instruction of the initial prompt, which does not affect the functionality of chatrepair.